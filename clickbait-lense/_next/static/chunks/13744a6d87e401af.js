(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,28147,79059,33953,35316,21282,86039,e=>{"use strict";var t=e.i(88037),a=e.i(29157),r=e.i(31601),s=e.i(41290),i=e.i(44649),l=e.i(80666),n=e.i(1828),o=e.i(65161),p=e.i(65898),m=e.i(57933),u=e.i(69966),c=e.i(95529),f=e.i(99855);let h=(e,t)=>{let a=[...new Set(t?.map(e=>{if("string"==typeof e)return e;let t=new e({});if(!("getType"in t)||"function"!=typeof t.getType)throw Error("Invalid type provided.");return t.getType()}))],r=e.getType();return a.some(e=>e===r)};function g(e,t){return Array.isArray(e)?b(e,t):u.RunnableLambda.from(t=>b(t,e))}function b(e,t={}){let{includeNames:a,excludeNames:r,includeTypes:s,excludeTypes:i,includeIds:l,excludeIds:n}=t,o=[];for(let t of e)if(!(r&&t.name&&r.includes(t.name))){if(i&&h(t,i))continue;if(n&&t.id&&n.includes(t.id))continue;s||l||a?a&&t.name&&a.some(e=>e===t.name)||s&&h(t,s)?o.push(t):l&&t.id&&l.some(e=>e===t.id)&&o.push(t):o.push(t)}return o}function d(e){return Array.isArray(e)?y(e):u.RunnableLambda.from(y)}function y(e){if(!e.length)return[];let t=[];for(let a of e){let e=t.pop();if(e)if("tool"===a.getType()||a.getType()!==e.getType())t.push(e,a);else{let r=(0,m.convertToChunk)(e),s=(0,m.convertToChunk)(a),i=r.concat(s);"string"==typeof r.content&&"string"==typeof s.content&&(i.content=`${r.content}
${s.content}`),t.push(function(e){let t,a=e.getType(),r=Object.fromEntries(Object.entries(e).filter(([e])=>!["type","tool_call_chunks"].includes(e)&&!e.startsWith("lc_")));if(a in _&&(t=M(a,r)),!t)throw Error(`Unrecognized message chunk class ${a}. Supported classes are ${Object.keys(_)}`);return t}(i))}else t.push(a)}return t}function w(e,t){if(!Array.isArray(e))return u.RunnableLambda.from(t=>v(t,e)).withConfig({runName:"trim_messages"});if(!t)throw Error("Options parameter is required when providing messages.");return v(e,t)}async function v(e,t){let a,{maxTokens:r,tokenCounter:s,strategy:i="last",allowPartial:l=!1,endOn:n,startOn:o,includeSystem:p=!1,textSplitter:m}=t;if(o&&"first"===i)throw Error("`startOn` should only be specified if `strategy` is 'last'.");if(p&&"first"===i)throw Error("`includeSystem` should only be specified if `strategy` is 'last'.");a="getNumTokens"in s?async e=>(await Promise.all(e.map(e=>s.getNumTokens(e.content)))).reduce((e,t)=>e+t,0):async e=>s(e);let u=T;if(m&&(u="splitText"in m?m.splitText:async e=>m(e)),"first"===i)return x(e,{maxTokens:r,tokenCounter:a,textSplitter:u,partialStrategy:l?"first":void 0,endOn:n});if("last"===i)return P(e,{maxTokens:r,tokenCounter:a,textSplitter:u,allowPartial:l,includeSystem:p,startOn:o,endOn:n});throw Error(`Unrecognized strategy: '${i}'. Must be one of 'first' or 'last'.`)}async function x(e,t){let{maxTokens:a,tokenCounter:r,textSplitter:s,partialStrategy:i,endOn:l}=t,n=[...e],o=0;for(let e=0;e<n.length;e+=1){let t=e>0?n.slice(0,-e):n;if(await r(t)<=a){o=n.length-e;break}}if(o<n.length&&i){let e=!1;if(Array.isArray(n[o].content)){let t=n[o];if("string"==typeof t.content)throw Error("Expected content to be an array.");let s=t.content.length,l="last"===i?[...t.content].reverse():t.content;for(let p=1;p<=s;p+=1){let s="first"===i?l.slice(0,p):l.slice(-p),m=Object.fromEntries(Object.entries(t).filter(([e])=>"type"!==e&&!e.startsWith("lc_"))),u=M(t.getType(),{...m,content:s}),c=[...n.slice(0,o),u];if(await r(c)<=a)n=c,o+=1,e=!0;else break}e&&"last"===i&&(t.content=[...l].reverse())}if(!e){let e,t=n[o];if(Array.isArray(t.content)&&t.content.some(e=>"string"==typeof e||"text"===e.type)){let a=t.content.find(e=>"text"===e.type&&e.text);e=a?.text}else"string"==typeof t.content&&(e=t.content);if(e){let l=await s(e),p=l.length;"last"===i&&l.reverse();for(let e=0;e<p-1;e+=1)if(l.pop(),t.content=l.join(""),await r([...n.slice(0,o),t])<=a){"last"===i&&(t.content=[...l].reverse().join("")),n=[...n.slice(0,o),t],o+=1;break}}}}if(l){let e=Array.isArray(l)?l:[l];for(;o>0&&!h(n[o-1],e);)o-=1}return n.slice(0,o)}async function P(e,t){let{allowPartial:a=!1,includeSystem:r=!1,endOn:s,startOn:l,...n}=t,o=e.map(e=>{let t=Object.fromEntries(Object.entries(e).filter(([e])=>"type"!==e&&!e.startsWith("lc_")));return M(e.getType(),t,(0,i.isBaseMessageChunk)(e))});if(s){let e=Array.isArray(s)?s:[s];for(;o.length>0&&!h(o[o.length-1],e);)o=o.slice(0,-1)}let p=r&&o[0]?.getType()==="system",m=p?o.slice(0,1).concat(o.slice(1).reverse()):o.reverse();return(m=await x(m,{...n,partialStrategy:a?"last":void 0,endOn:l}),p)?[m[0],...m.slice(1).reverse()]:m.reverse()}let _={human:{message:o.HumanMessage,messageChunk:o.HumanMessageChunk},ai:{message:s.AIMessage,messageChunk:s.AIMessageChunk},system:{message:p.SystemMessage,messageChunk:p.SystemMessageChunk},developer:{message:p.SystemMessage,messageChunk:p.SystemMessageChunk},tool:{message:f.ToolMessage,messageChunk:f.ToolMessageChunk},function:{message:n.FunctionMessage,messageChunk:n.FunctionMessageChunk},generic:{message:l.ChatMessage,messageChunk:l.ChatMessageChunk},remove:{message:c.RemoveMessage,messageChunk:c.RemoveMessage}};function M(e,t,a){let r,i;switch(e){case"human":a?r=new o.HumanMessageChunk(t):i=new o.HumanMessage(t);break;case"ai":if(a){let e={...t};"tool_calls"in e&&(e={...e,tool_call_chunks:e.tool_calls?.map(e=>({...e,type:"tool_call_chunk",index:void 0,args:JSON.stringify(e.args)}))}),r=new s.AIMessageChunk(e)}else i=new s.AIMessage(t);break;case"system":a?r=new p.SystemMessageChunk(t):i=new p.SystemMessage(t);break;case"developer":a?r=new p.SystemMessageChunk({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}}):i=new p.SystemMessage({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});break;case"tool":if("tool_call_id"in t)a?r=new f.ToolMessageChunk(t):i=new f.ToolMessage(t);else throw Error("Can not convert ToolMessage to ToolMessageChunk if 'tool_call_id' field is not defined.");break;case"function":if(a)r=new n.FunctionMessageChunk(t);else{if(!t.name)throw Error("FunctionMessage must have a 'name' field");i=new n.FunctionMessage(t)}break;case"generic":if("role"in t)a?r=new l.ChatMessageChunk(t):i=new l.ChatMessage(t);else throw Error("Can not convert ChatMessage to ChatMessageChunk if 'role' field is not defined.");break;default:throw Error(`Unrecognized message type ${e}`)}if(a&&r)return r;if(i)return i;throw Error(`Unrecognized message type ${e}`)}function T(e){let t=e.split("\n");return Promise.resolve([...t.slice(0,-1).map(e=>`${e}
`),t[t.length-1]])}e.s(["defaultTextSplitter",()=>T,"filterMessages",()=>g,"mergeMessageRuns",()=>d,"trimMessages",()=>w],79059),e.i(50579),e.s([],33953);var O=e.i(96170),C=u,j=e.i(98470),F=j;class S extends F.BasePromptTemplate{static lc_name(){return"ImagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","image"]}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.template=e.template,this.templateFormat=e.templateFormat??this.templateFormat,this.validateTemplate=e.validateTemplate??this.validateTemplate,this.additionalContentFields=e.additionalContentFields,this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,a.checkValidTemplate)([{type:"image_url",image_url:this.template}],this.templateFormat,e)}}_getPromptType(){return"prompt"}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),a={...this.partialVariables??{},...e};return new S({...this,inputVariables:t,partialVariables:a})}async format(e){let t={};for(let[r,s]of Object.entries(this.template))"string"==typeof s?t[r]=(0,a.renderTemplate)(s,this.templateFormat,e):t[r]=s;let r=e.url||t.url,s=e.detail||t.detail;if(!r)throw Error("Must provide either an image URL.");if("string"!=typeof r)throw Error("url must be a string.");let i={url:r};return s&&(i.detail=s),i}async formatPromptValue(e){let t=await this.format(e);return new O.ImagePromptValue(t)}}e.s(["ImagePromptTemplate",()=>S],35316);var k=e.i(56437),V=u;class E extends V.Runnable{static lc_name(){return"DictPromptTemplate"}constructor(e){const t=e.templateFormat??"f-string",r=function e(t,r){let s=[];for(let i of Object.values(t))if("string"==typeof i)(0,a.parseTemplate)(i,r).forEach(e=>{"variable"===e.type&&s.push(e.name)});else if(Array.isArray(i))for(let t of i)"string"==typeof t?(0,a.parseTemplate)(t,r).forEach(e=>{"variable"===e.type&&s.push(e.name)}):"object"==typeof t&&s.push(...e(t,r));else"object"==typeof i&&null!==i&&s.push(...e(i,r));return Array.from(new Set(s))}(e.template,t);super({inputVariables:r,...e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","dict"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.template=e.template,this.templateFormat=t,this.inputVariables=r}async format(e){return function e(t,r,s){let i={};for(let[l,n]of Object.entries(t))if("string"==typeof n)i[l]=(0,a.renderTemplate)(n,s,r);else if(Array.isArray(n)){let t=[];for(let i of n)"string"==typeof i?t.push((0,a.renderTemplate)(i,s,r)):"object"==typeof i&&t.push(e(i,r,s));i[l]=t}else"object"==typeof n&&null!==n?i[l]=e(n,r,s):i[l]=n;return i}(this.template,e,this.templateFormat)}async invoke(e){return await this._callWithConfig(this.format.bind(this),e,{runType:"prompt"})}}e.s(["DictPromptTemplate",()=>E],21282);class A extends C.Runnable{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig(e=>this.formatMessages(e),e,{...t,runType:"prompt"})}}class I extends A{static lc_name(){return"MessagesPlaceholder"}constructor(e){"string"==typeof e&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optional",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName,this.optional=e.optional??!1}get inputVariables(){return[this.variableName]}async formatMessages(e){let t,a=e[this.variableName];if(this.optional&&!a)return[];if(!a){let e=Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw e.name="InputFormatError",e}try{t=Array.isArray(a)?a.map(m.coerceMessageLikeToMessage):[(0,m.coerceMessageLikeToMessage)(a)]}catch(r){let e="string"==typeof a?a:JSON.stringify(a,null,2),t=Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages or coerceable values as input.

Received value: ${e}

Additional message: ${r.message}`);throw t.name="InputFormatError",t.lc_error_code=r.lc_error_code,t}return t}}class $ extends A{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class N extends j.BasePromptTemplate{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){let t=await this.formatMessages(e);return new O.ChatPromptValue(t)}}class z extends ${static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new l.ChatMessage(await this.prompt.format(e),this.role)}static fromTemplate(e,t,a){return new this(r.PromptTemplate.fromTemplate(e,{templateFormat:a?.templateFormat}),t)}}class B extends A{static _messageClass(){throw Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}constructor(e,t){if("prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"additionalOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,Array.isArray(this.prompt)){let e=[];this.prompt.forEach(t=>{"inputVariables"in t&&(e=e.concat(t.inputVariables))}),this.inputVariables=e}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=t??this.additionalOptions}createMessage(e){let t=this.constructor;if(t._messageClass())return new(t._messageClass())({content:e});if(t.chatMessageClass){let a=t.chatMessageClass();return new a({content:e,role:this.getRoleFromMessageClass(a.lc_name())})}throw Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw Error("Invalid message class name")}}static fromTemplate(e,t){if("string"==typeof e)return new this(r.PromptTemplate.fromTemplate(e,t));let s=[];for(let i of e)if("string"==typeof i)s.push(r.PromptTemplate.fromTemplate(i,t));else if(null===i);else if(!(null===i||"object"!=typeof i||Array.isArray(i))&&1===Object.keys(i).length&&"text"in i&&"string"==typeof i.text){let e="";"string"==typeof i.text&&(e=i.text??"");let a={...t,additionalContentFields:i};s.push(r.PromptTemplate.fromTemplate(e,a))}else if(!(null===i||"object"!=typeof i||Array.isArray(i))&&"image_url"in i&&("string"==typeof i.image_url||"object"==typeof i.image_url&&null!==i.image_url&&"url"in i.image_url&&"string"==typeof i.image_url.url)){let e,r=i.image_url??"",l=[];if("string"==typeof r){let s=(t?.templateFormat==="mustache"?(0,a.parseMustache)(r):(0,a.parseFString)(r)).flatMap(e=>"variable"===e.type?[e.name]:[]);if((s?.length??0)>0){if(s.length>1)throw Error(`Only one format variable allowed per image template.
Got: ${s}
From: ${r}`);l=[s[0]]}else l=[];e=new S({template:r={url:r},inputVariables:l,templateFormat:t?.templateFormat,additionalContentFields:i})}else if("object"==typeof r){if("url"in r)l=(t?.templateFormat==="mustache"?(0,a.parseMustache)(r.url):(0,a.parseFString)(r.url)).flatMap(e=>"variable"===e.type?[e.name]:[]);else l=[];e=new S({template:r,inputVariables:l,templateFormat:t?.templateFormat,additionalContentFields:i})}else throw Error("Invalid image template");s.push(e)}else"object"==typeof i&&s.push(new E({template:i,templateFormat:t?.templateFormat}));return new this({prompt:s,additionalOptions:t})}async format(e){if(this.prompt instanceof t.BaseStringPromptTemplate){let t=await this.prompt.format(e);return this.createMessage(t)}{let a=[];for(let r of this.prompt){let s={};if(!("inputVariables"in r))throw Error(`Prompt ${r} does not have inputVariables defined.`);for(let t of r.inputVariables)s={...s,[t]:e[t]};if(r instanceof t.BaseStringPromptTemplate){let e,t=await r.format(s);"additionalContentFields"in r&&(e=r.additionalContentFields),""!==t&&a.push({...e,type:"text",text:t})}else if(r instanceof S){let e,t=await r.format(s);"additionalContentFields"in r&&(e=r.additionalContentFields),a.push({...e,type:"image_url",image_url:t})}else if(r instanceof E){let e,t=await r.format(s);"additionalContentFields"in r&&(e=r.additionalContentFields),a.push({...e,...t})}}return this.createMessage(a)}}async formatMessages(e){return[await this.format(e)]}}class R extends B{static _messageClass(){return o.HumanMessage}static lc_name(){return"HumanMessagePromptTemplate"}}class U extends B{static _messageClass(){return s.AIMessage}static lc_name(){return"AIMessagePromptTemplate"}}class L extends B{static _messageClass(){return p.SystemMessage}static lc_name(){return"SystemMessagePromptTemplate"}}class H extends N{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),"mustache"===e.templateFormat&&void 0===e.validateTemplate&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){const e=new Set;for(const t of this.promptMessages)if(!(t instanceof i.BaseMessage))for(const a of t.inputVariables)e.add(a);const t=this.inputVariables,a=new Set(this.partialVariables?t.concat(Object.keys(this.partialVariables)):t),r=new Set([...a].filter(t=>!e.has(t)));if(r.size>0)throw Error(`Input variables \`${[...r]}\` are not used in any of the prompt messages.`);const s=new Set([...e].filter(e=>!a.has(e)));if(s.size>0)throw Error(`Input variables \`${[...s]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if("string"==typeof e.content)return e;let a=await Promise.all(e.content.map(async e=>{if("image_url"!==e.type)return e;let a="";a="string"==typeof e.image_url?e.image_url:e.image_url.url;let s=r.PromptTemplate.fromTemplate(a,{templateFormat:this.templateFormat}),i=await s.format(t);return"string"!=typeof e.image_url&&"url"in e.image_url?e.image_url.url=i:e.image_url=i,e}));return e.content=a,e}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),a=[];for(let e of this.promptMessages)if(e instanceof i.BaseMessage)a.push(await this._parseImagePrompts(e,t));else{let r;r="mustache"===this.templateFormat?{...t}:e.inputVariables.reduce((a,r)=>{if(!(r in t)&&!("MessagesPlaceholder"===e.constructor.lc_name()&&e.optional))throw(0,k.addLangChainErrorFields)(Error(`Missing value for input variable \`${r.toString()}\``),"INVALID_PROMPT_INPUT");return a[r]=t[r],a},{});let s=await e.formatMessages(r);a=a.concat(s)}return a}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),a={...this.partialVariables??{},...e};return new H({...this,inputVariables:t,partialVariables:a})}static fromTemplate(e,t){let a=new R({prompt:r.PromptTemplate.fromTemplate(e,t)});return this.fromMessages([a])}static fromMessages(e,t){let a=e.reduce((e,a)=>e.concat(a instanceof H?a.promptMessages:[function(e,t){let a;if("function"==typeof e.formatMessages||(0,i.isBaseMessage)(e))return e;if(Array.isArray(e)&&"placeholder"===e[0]){let a=e[1];if(t?.templateFormat==="mustache"&&"string"==typeof a&&"{{"===a.slice(0,2)&&"}}"===a.slice(-2))return new I({variableName:a.slice(2,-2),optional:!0});if("string"==typeof a&&"{"===a[0]&&"}"===a[a.length-1])return new I({variableName:a.slice(1,-1),optional:!0});throw Error(`Invalid placeholder template for format ${t?.templateFormat??'"f-string"'}: "${e[1]}". Expected a variable name surrounded by ${t?.templateFormat==="mustache"?"double":"single"} curly braces.`)}let r=(0,m.coerceMessageLikeToMessage)(e);if(a="string"==typeof r.content?r.content:r.content.map(e=>"text"in e?{...e,text:e.text}:"image_url"in e?{...e,image_url:e.image_url}:e),"human"===r._getType())return R.fromTemplate(a,t);if("ai"===r._getType())return U.fromTemplate(a,t);if("system"===r._getType())return L.fromTemplate(a,t);if(l.ChatMessage.isInstance(r))return z.fromTemplate(r.content,r.role,t);throw Error(`Could not coerce message prompt template from input. Received message type: "${r._getType()}".`)}(a,t)]),[]),r=e.reduce((e,t)=>t instanceof H?Object.assign(e,t.partialVariables):e,Object.create(null)),s=new Set;for(let e of a)if(!(e instanceof i.BaseMessage))for(let t of e.inputVariables)t in r||s.add(t);return new this({...t,inputVariables:[...s],promptMessages:a,partialVariables:r,templateFormat:t?.templateFormat})}static fromPromptMessages(e){return this.fromMessages(e)}}e.s(["AIMessagePromptTemplate",()=>U,"BaseChatPromptTemplate",()=>N,"BaseMessagePromptTemplate",()=>A,"BaseMessageStringPromptTemplate",()=>$,"ChatMessagePromptTemplate",()=>z,"ChatPromptTemplate",()=>H,"HumanMessagePromptTemplate",()=>R,"MessagesPlaceholder",()=>I,"SystemMessagePromptTemplate",()=>L],86039);class W extends t.BaseStringPromptTemplate{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),void 0!==this.examples&&void 0!==this.exampleSelector)throw Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,a.checkValidTemplate)(this.prefix+this.suffix,this.templateFormat,e)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),a={...this.partialVariables??{},...e};return new W({...this,inputVariables:t,partialVariables:a})}async format(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),s=await Promise.all(r.map(e=>this.examplePrompt.format(e))),i=[this.prefix,...s,this.suffix].join(this.exampleSeparator);return(0,a.renderTemplate)(i,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){let t,{example_prompt:a}=e;if(!a)throw Error("Missing example prompt");let s=await r.PromptTemplate.deserialize(a);if(Array.isArray(e.examples))t=e.examples;else throw Error("Invalid examples format. Only list or string are supported.");return new W({inputVariables:e.input_variables,examplePrompt:s,examples:t,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}class D extends N{_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.examples=e.examples,this.examplePrompt=e.examplePrompt,this.exampleSeparator=e.exampleSeparator??"\n\n",this.exampleSelector=e.exampleSelector,this.prefix=e.prefix??"",this.suffix=e.suffix??"",this.templateFormat=e.templateFormat??"f-string",this.validateTemplate=e.validateTemplate??!0,void 0!==this.examples&&void 0!==this.exampleSelector)throw Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,a.checkValidTemplate)(this.prefix+this.suffix,this.templateFormat,e)}}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw Error("One of 'examples' and 'example_selector' should be provided")}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),a=await this.getExamples(t);a=a.map(e=>{let t={};return this.examplePrompt.inputVariables.forEach(a=>{t[a]=e[a]}),t});let r=[];for(let e of a){let t=await this.examplePrompt.formatMessages(e);r.push(...t)}return r}async format(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),s=(await Promise.all(r.map(e=>this.examplePrompt.formatMessages(e)))).flat().map(e=>e.content),i=[this.prefix,...s,this.suffix].join(this.exampleSeparator);return(0,a.renderTemplate)(i,this.templateFormat,t)}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),a={...this.partialVariables??{},...e};return new D({...this,inputVariables:t,partialVariables:a})}}e.s(["FewShotChatMessagePromptTemplate",()=>D,"FewShotPromptTemplate",()=>W],28147)},40950,e=>{e.v(e=>Promise.resolve().then(()=>e(31601)))},86614,e=>{e.v(e=>Promise.resolve().then(()=>e(28147)))}]);